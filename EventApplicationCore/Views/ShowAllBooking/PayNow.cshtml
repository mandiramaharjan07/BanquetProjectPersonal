@{
    Layout = "~/Views/Shared/_LayoutCustomer.cshtml";
    var bookingId = ViewData["BookingID"].ToString();

}

<div class="row">
    <div class="col-md-12">
        @using (Html.BeginForm("BuyCredit", "Participant", FormMethod.Post, new { id = "payment-form" }))
        {
            <input type="hidden" id="bookingId" value="@bookingId">

            <div id="Payment-Content">
                <h4 class="" id="myLargeModalLabel">Payment Gateway </h4>
                <div>
                    <label for="">
                        Amount
                    </label>
                    <input type="text" id="amount">
                    <div class="form-row" id="PaymnetBody">
                        <label for="">
                            Credit or debit card
                        </label>
                        <br />
                        <div id="card-element" style="width:100% !important">
                            <!-- A Stripe Element will be inserted here. -->
                        </div>
                        <!-- Used to display form errors. -->
                        <div id="card-errors" role="alert"></div>


                    </div>



                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="payBtn">Submit Payment</button>

            </div>
        }
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<script src="https://js.stripe.com/v3/"></script>

<script>
    $(document).ready(function() {

        var apiKey = "pk_test_orG9rBvfEv3Ve6POilz99UNf";
        var stripe = Stripe(apiKey);
        var elements = stripe.elements();
        var card = elements.create('card');
        card.mount('#card-element');
        card.addEventListener('change', function(event) {
            var displayError = document.getElementById('card-errors');
            if (event.error) {
                displayError.textContent = event.error.message;
            } else {
                displayError.textContent = '';
            }
        });
        $('#payBtn').click(function() {
            debugger
            stripe.createToken(card).then(function(result) {
                debugger
                if (result.error) {
                    // Inform the user if there was an error.
                    var errorElement = document.getElementById('card-errors');
                    errorElement.textContent = result.error.message;
                } else {
                    // Send the token to your server.
                    var tok = result.token.id;
                    $.ajax({
                        url: '@Url.Action("UpdateAdvancePayment","ShowAllBooking")',
                        type: 'POST',
                        data: { BookingID: $("#bookingId").val(), amount: $("#amount").val(),token : tok },
                        dataType: 'json',
                        success: function(data, strStatus) {

                            alert("Success");
                            
                            window.location.href = 'http://localhost:5544/ShowAllBooking/AllBookings'
                        },
                        error: function(error) {
                            alert("Failed");
                        }
                    });
                }
            });

        });

    });


</script>
